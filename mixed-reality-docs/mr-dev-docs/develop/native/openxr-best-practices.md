---
title: Bonnes pratiques avec OpenXR
description: Découvrez les meilleures pratiques en matière de qualité, de stabilité et de performances visuelles pour vos applications OpenXR.
author: thetuvix
ms.author: alexturn
ms.date: 2/28/2020
ms.topic: article
keywords: OpenXR, Khronos, BasicXRApp, DirectX, native, application native, moteur personnalisé, intergiciel, meilleures pratiques, performances, qualité, stabilité
ms.openlocfilehash: dad4622e4186ecc8b090e2abe2e33d3d39ac7525
ms.sourcegitcommit: 09599b4034be825e4536eeb9566968afd021d5f3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/03/2020
ms.locfileid: "91679362"
---
# <a name="openxr-app-best-practices"></a><span data-ttu-id="4145a-104">Meilleures pratiques pour les applications OpenXR</span><span class="sxs-lookup"><span data-stu-id="4145a-104">OpenXR app best practices</span></span>

<span data-ttu-id="4145a-105">Vous pouvez voir un exemple des meilleures pratiques ci-dessous dans le fichier OpenXRProgram. cpp de <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>.</span><span class="sxs-lookup"><span data-stu-id="4145a-105">You can see an example of the best practices below in <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>'s OpenXRProgram.cpp file.</span></span> <span data-ttu-id="4145a-106">La fonction Run () au début capture un flot de code d’application OpenXR typique de l’initialisation à l’événement et à la boucle de rendu.</span><span class="sxs-lookup"><span data-stu-id="4145a-106">The Run() function at the beginning captures a typical OpenXR app code flow from initialization to the event and rendering loop.</span></span>

## <a name="best-practices-for-visual-quality-and-stability"></a><span data-ttu-id="4145a-107">Meilleures pratiques en matière de qualité et de stabilité visuelles</span><span class="sxs-lookup"><span data-stu-id="4145a-107">Best practices for visual quality and stability</span></span>

<span data-ttu-id="4145a-108">Les meilleures pratiques décrites dans cette section expliquent comment obtenir la meilleure qualité visuelle et la meilleure stabilité dans n’importe quelle application OpenXR.</span><span class="sxs-lookup"><span data-stu-id="4145a-108">The best practices in this section describe how to get the best visual quality and stability in any OpenXR application.</span></span>

<span data-ttu-id="4145a-109">Pour obtenir d’autres recommandations relatives aux performances propres à HoloLens 2, consultez la section [meilleures pratiques en matière de performances sur hololens 2](#best-practices-for-performance-on-hololens-2) ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="4145a-109">For further performance recommendations specific to HoloLens 2, see the [Best practices for performance on HoloLens 2](#best-practices-for-performance-on-hololens-2) section below.</span></span>

### <a name="gamma-correct-rendering"></a><span data-ttu-id="4145a-110">Gamma-rendu correct</span><span class="sxs-lookup"><span data-stu-id="4145a-110">Gamma-correct rendering</span></span>

<span data-ttu-id="4145a-111">Vous devez veiller à ce que le pipeline de rendu soit correct pour la valeur gamma.</span><span class="sxs-lookup"><span data-stu-id="4145a-111">Care must be taken to ensure that your rendering pipeline is gamma-correct.</span></span> <span data-ttu-id="4145a-112">Lors du rendu sur un utilise permutation, le format de la vue de cible de rendu doit correspondre au format utilise permutation (par exemple, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` pour le format utilise permutation et l’affichage de la cible Render).</span><span class="sxs-lookup"><span data-stu-id="4145a-112">When rendering to a swapchain, the render-target view format should match the swapchain format (e.g. `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` for both the swapchain format and the render-target view).</span></span>
<span data-ttu-id="4145a-113">L’exception est si le pipeline de rendu de l’application effectue une conversion sRVB manuelle dans le code du nuanceur. dans ce cas, l’application doit demander un format utilise permutation sRVB, mais utiliser le format linéaire pour la vue de la cible de rendu (par exemple, la demande `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` comme format utilise permutation, mais utiliser `DXGI_FORMAT_B8G8R8A8_UNORM` comme affichage de la cible de rendu) pour empêcher que le contenu soit corrigé.</span><span class="sxs-lookup"><span data-stu-id="4145a-113">The exception is if the app's rendering pipeline does a manual sRGB conversion in shader code, in which case the app should request an sRGB swapchain format but use the linear format for the render-target view (e.g. request `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` as the swapchain format but use `DXGI_FORMAT_B8G8R8A8_UNORM` as the render-target view) to prevent content from being double-gamma corrected.</span></span>

### <a name="submit-depth-buffer-for-projection-layers"></a><span data-ttu-id="4145a-114">Envoyer le tampon de profondeur pour les couches de projection</span><span class="sxs-lookup"><span data-stu-id="4145a-114">Submit depth buffer for projection layers</span></span>

<span data-ttu-id="4145a-115">Utilisez toujours `XR_KHR_composition_layer_depth` l’extension et soumettez la mémoire tampon de profondeur avec la couche de projection lors de l’envoi d’un frame à `xrEndFrame` .</span><span class="sxs-lookup"><span data-stu-id="4145a-115">Always use `XR_KHR_composition_layer_depth` extension and submit the depth buffer together with the projection layer when submitting a frame to `xrEndFrame`.</span></span>
<span data-ttu-id="4145a-116">Cela améliore la stabilité de l’hologramme en activant la reprojection de la profondeur matérielle sur HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="4145a-116">This improves hologram stability by enabling hardware depth reprojection on HoloLens 2.</span></span>

### <a name="choose-a-reasonable-depth-range"></a><span data-ttu-id="4145a-117">Choisir une plage de profondeur raisonnable</span><span class="sxs-lookup"><span data-stu-id="4145a-117">Choose a reasonable depth range</span></span>

<span data-ttu-id="4145a-118">Privilégiez une plage de profondeur plus étroite pour étendre le contenu virtuel afin d’aider à la stabilité de l’hologramme sur HoloLens.</span><span class="sxs-lookup"><span data-stu-id="4145a-118">Prefer a narrower depth range to scope the virtual content to help hologram stability on HoloLens.</span></span>
<span data-ttu-id="4145a-119">Par exemple, l’exemple OpenXrProgram. cpp utilise 0,1 à 20 mètres.</span><span class="sxs-lookup"><span data-stu-id="4145a-119">For example, the OpenXrProgram.cpp sample is using 0.1 to 20 meters.</span></span>
<span data-ttu-id="4145a-120">Utilisez [inversé-Z](https://developer.nvidia.com/content/depth-precision-visualized) pour une résolution de profondeur plus uniforme.</span><span class="sxs-lookup"><span data-stu-id="4145a-120">Use [reversed-Z](https://developer.nvidia.com/content/depth-precision-visualized) for a more uniform depth resolution.</span></span>
<span data-ttu-id="4145a-121">Notez que, sur HoloLens 2, l’utilisation du `DXGI_FORMAT_D16_UNORM` format de profondeur préféré permet d’obtenir un meilleur taux de trames et de meilleures performances, bien que les mémoires tampons de profondeur 16 bits offrent une résolution moins importante que les mémoires tampons de profondeur 24 bits.</span><span class="sxs-lookup"><span data-stu-id="4145a-121">Note that, on HoloLens 2, using the preferred `DXGI_FORMAT_D16_UNORM` depth format will help achieve better frame rate and performance, although 16-bit depth buffers provide less depth resolution than 24-bit depth buffers.</span></span>
<span data-ttu-id="4145a-122">Par conséquent, le fait de suivre ces meilleures pratiques pour tirer le meilleur parti de la résolution de profondeur devient plus important.</span><span class="sxs-lookup"><span data-stu-id="4145a-122">Therefore, following these best practices to make best use of the depth resolution becomes more important.</span></span>

### <a name="prepare-for-different-environment-blend-modes"></a><span data-ttu-id="4145a-123">Préparer les différents modes de fusion de l’environnement</span><span class="sxs-lookup"><span data-stu-id="4145a-123">Prepare for different environment blend modes</span></span>

<span data-ttu-id="4145a-124">Si votre application s’exécute également sur des casques immersifs qui bloquent complètement le monde, veillez à énumérer les modes de mélange d’environnement pris en charge à l’aide de l' `xrEnumerateEnvironmentBlendModes` API et à préparer le contenu de rendu en conséquence.</span><span class="sxs-lookup"><span data-stu-id="4145a-124">If your application will also run on immersive headsets that completely block out the world, be sure to enumerate supported environment blend modes using `xrEnumerateEnvironmentBlendModes` API, and prepare your rendering content accordingly.</span></span>
<span data-ttu-id="4145a-125">Par exemple, pour un système avec `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` tel que HoloLens, l’application doit utiliser transparent comme couleur claire, tandis que pour un système avec `XR_ENVIRONMENT_BLEND_MODE_OPAQUE` , l’application doit restituer une couleur opaque ou une salle virtuelle en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="4145a-125">For example, for a system with `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` such as the HoloLens, the app should use transparent as the clear color, while for a system with `XR_ENVIRONMENT_BLEND_MODE_OPAQUE`, the app should render some opaque color or some virtual room in the background.</span></span>

### <a name="choose-unbounded-reference-space-as-applications-root-space"></a><span data-ttu-id="4145a-126">Choisir l’espace de référence illimité comme espace racine de l’application</span><span class="sxs-lookup"><span data-stu-id="4145a-126">Choose unbounded reference space as application's root space</span></span>

<span data-ttu-id="4145a-127">En règle générale, les applications établissent un espace de coordonnées universel pour connecter des vues, des actions et des hologrammes.</span><span class="sxs-lookup"><span data-stu-id="4145a-127">Applications typically establish some root world coordinate space to connect views, actions and holograms together.</span></span>
<span data-ttu-id="4145a-128">Utilisez `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` lorsque l’extension est prise en charge pour établir un système de coordonnées à l' [échelle du monde](../../design/coordinate-systems.md#building-a-world-scale-experience), ce qui permet à votre application d’éviter la dérive d’hologramme indésirable lorsque l’utilisateur se déplace jusqu’à présent (par exemple, 5 mètres) à partir de l’emplacement où l’application démarre.</span><span class="sxs-lookup"><span data-stu-id="4145a-128">Use `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` when the extension is supported to establish a [world-scale coordinate system](../../design/coordinate-systems.md#building-a-world-scale-experience), enabling your app to avoid undesired hologram drift when the user moves far (e.g. 5 meters away) from where the app starts.</span></span>
<span data-ttu-id="4145a-129">`XR_REFERENCE_SPACE_TYPE_LOCAL`À utiliser comme secours si l’extension de l’espace non lié n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="4145a-129">Use `XR_REFERENCE_SPACE_TYPE_LOCAL` as a fallback if the unbounded space extension doesn't exist.</span></span>

### <a name="associate-hologram-with-spatial-anchor"></a><span data-ttu-id="4145a-130">Associer l’hologramme avec l’ancrage spatial</span><span class="sxs-lookup"><span data-stu-id="4145a-130">Associate hologram with spatial anchor</span></span>

<span data-ttu-id="4145a-131">Lors de l’utilisation d’un espace de référence non lié, les hologrammes que vous placez directement dans cet espace de référence [peuvent dériver lorsque l’utilisateur parcourt des salles distantes, puis revient](../../design/coordinate-systems.md#building-a-world-scale-experience).</span><span class="sxs-lookup"><span data-stu-id="4145a-131">When using an unbounded reference space, holograms you place directly in that reference space [may drift as the user walks to distant rooms and then comes back](../../design/coordinate-systems.md#building-a-world-scale-experience).</span></span>
<span data-ttu-id="4145a-132">Pour les utilisateurs d’hologrammes placés à un emplacement discret dans le monde, [créez une ancre spatiale](../../design/spatial-anchors.md#best-practices) à l’aide de la `xrCreateSpatialAnchorSpaceMSFT` fonction d’extension et positionnez l’hologramme à son origine.</span><span class="sxs-lookup"><span data-stu-id="4145a-132">For hologram users place at a discrete location in the world, [create a spatial anchor](../../design/spatial-anchors.md#best-practices) using the `xrCreateSpatialAnchorSpaceMSFT` extension function and position the hologram at its origin.</span></span>
<span data-ttu-id="4145a-133">Cela permet de maintenir la stabilité de l’hologramme indépendamment dans le temps.</span><span class="sxs-lookup"><span data-stu-id="4145a-133">That will keep that hologram independently stable over time.</span></span>

### <a name="support-mixed-reality-capture"></a><span data-ttu-id="4145a-134">Prendre en charge la capture de réalité mixte</span><span class="sxs-lookup"><span data-stu-id="4145a-134">Support mixed reality capture</span></span>

<span data-ttu-id="4145a-135">Bien que l’affichage principal de HoloLens 2 utilise la fusion d’environnement additive, lorsque l’utilisateur initie une [capture de réalité mixte](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), le contenu de rendu de l’application est mélangé à l’alpha avec le flux vidéo de l’environnement.</span><span class="sxs-lookup"><span data-stu-id="4145a-135">Although HoloLens 2's primary display uses additive environment blending, when the user initiates [mixed reality capture](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), the app's rendering content will be alpha-blended with the environment video stream.</span></span>
<span data-ttu-id="4145a-136">Pour obtenir la meilleure qualité visuelle dans les vidéos de capture de réalité mixte, il est préférable de définir le `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` dans le de la couche de projection `layerFlags` .</span><span class="sxs-lookup"><span data-stu-id="4145a-136">To achieve the best visual quality in mixed reality capture videos, it's best to set the `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` in your projection layer's `layerFlags`.</span></span>

## <a name="best-practices-for-performance-on-hololens-2"></a><span data-ttu-id="4145a-137">Meilleures pratiques en matière de performances sur HoloLens 2</span><span class="sxs-lookup"><span data-stu-id="4145a-137">Best practices for performance on HoloLens 2</span></span>

<span data-ttu-id="4145a-138">En tant qu’appareil mobile avec prise en charge de la reprojection matérielle, HoloLens 2 a des exigences plus strictes pour obtenir des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="4145a-138">As a mobile device with hardware reprojection support, HoloLens 2 has stricter requirements to obtain optimal performance.</span></span>  <span data-ttu-id="4145a-139">Il existe plusieurs façons d’envoyer des données de composition via, `xrEndFrame` ce qui entraînera une baisse notable des performances.</span><span class="sxs-lookup"><span data-stu-id="4145a-139">There are a number of ways to submit composition data through `xrEndFrame` which will result in post-processing that will have a noticeable performance penalty.</span></span>

### <a name="select-a-swapchain-format"></a><span data-ttu-id="4145a-140">Sélectionner un format de utilise permutation</span><span class="sxs-lookup"><span data-stu-id="4145a-140">Select a swapchain format</span></span>

<span data-ttu-id="4145a-141">Énumérez toujours les formats de pixel pris en charge à l’aide de `xrEnumerateSwapchainFormats` , puis choisissez le premier format de pixel de couleur et de profondeur du runtime pris en charge par l’application, car c’est ce que le runtime préfère pour des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="4145a-141">Always enumerate supported pixel formats using `xrEnumerateSwapchainFormats`, and choose the first color and depth pixel format from the runtime that the app supports, because that's what the runtime prefers for optimal performance.</span></span> <span data-ttu-id="4145a-142">Notez, sur HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` et `DXGI_FORMAT_D16_UNORM` est généralement le premier choix pour obtenir de meilleures performances de rendu.</span><span class="sxs-lookup"><span data-stu-id="4145a-142">Note, on HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` and `DXGI_FORMAT_D16_UNORM` is typically the first choice to achieve better rendering performance.</span></span> <span data-ttu-id="4145a-143">Cette préférence peut être différente sur les casques de VR qui s’exécutent sur un PC de bureau, où les mémoires tampons de profondeur de 24 bits ont moins d’impact sur les performances.</span><span class="sxs-lookup"><span data-stu-id="4145a-143">This preference can be different on VR headsets running on a Desktop PC, where 24-bit depth buffers have less of a performance impact.</span></span>
  
<span data-ttu-id="4145a-144">**Avertissement de performance :** L’utilisation d’un format autre que le format de couleur utilise permutation principal entraîne une baisse significative des performances du Runtime.</span><span class="sxs-lookup"><span data-stu-id="4145a-144">**Performance Warning:** Using a format other than the primary swapchain color format will result in runtime post-processing which comes at a significant performance penalty.</span></span>

### <a name="render-with-recommended-rendering-parameters-and-frame-timing"></a><span data-ttu-id="4145a-145">Rendu avec les paramètres de rendu recommandés et le minutage des frames</span><span class="sxs-lookup"><span data-stu-id="4145a-145">Render with recommended rendering parameters and frame timing</span></span>

<span data-ttu-id="4145a-146">Rendez toujours le rendu avec la largeur/hauteur de la configuration d’affichage recommandé ( `recommendedImageRectWidth` et `recommendedImageRectHeight` de `XrViewConfigurationView` ), et utilisez toujours l' `xrLocateViews` API pour interroger la vue recommandée pose, le point de vue et autres paramètres de rendu avant le rendu.</span><span class="sxs-lookup"><span data-stu-id="4145a-146">Always render with the recommended view configuration width/height (`recommendedImageRectWidth` and `recommendedImageRectHeight` from `XrViewConfigurationView`), and always use `xrLocateViews` API to query for the recommended view pose, fov, and other rendering parameters before rendering.</span></span>
<span data-ttu-id="4145a-147">Utilisez toujours le `XrFrameEndInfo.predictedDisplayTime` de l’appel le plus récent `xrWaitFrame` lors de l’interrogation des poses et des vues.</span><span class="sxs-lookup"><span data-stu-id="4145a-147">Always use the `XrFrameEndInfo.predictedDisplayTime` from the latest `xrWaitFrame` call when querying for poses and views.</span></span>
<span data-ttu-id="4145a-148">Cela permet à HoloLens d’ajuster le rendu et d’optimiser la qualité visuelle pour la personne qui porte le HoloLens.</span><span class="sxs-lookup"><span data-stu-id="4145a-148">This allows HoloLens to adjust rendering and optimize visual quality for the person who is wearing the HoloLens.</span></span>

### <a name="use-a-single-projection-layer"></a><span data-ttu-id="4145a-149">Utiliser une seule couche de projection</span><span class="sxs-lookup"><span data-stu-id="4145a-149">Use a single projection layer</span></span>

<span data-ttu-id="4145a-150">HoloLens 2 offre une puissance GPU limitée pour les applications afin de restituer le contenu et un compositeur matériel optimisé pour une couche de projection unique.</span><span class="sxs-lookup"><span data-stu-id="4145a-150">HoloLens 2 has limited GPU power for applications to render content and a hardware compositor optimized for a single projection layer.</span></span>
<span data-ttu-id="4145a-151">En utilisant toujours une seule couche de projection, vous pouvez améliorer la fréquence de l’application, la stabilité de l’hologramme et la qualité visuelle.</span><span class="sxs-lookup"><span data-stu-id="4145a-151">Always using a single projection layer can help the application's framerate, hologram stability and visual quality.</span></span>  
  
<span data-ttu-id="4145a-152">**Avertissement de performance :** L’envoi de tout sauf une seule couche de protection entraînera un traitement postérieur au moment de l’exécution, ce qui se traduit par une baisse significative des performances.</span><span class="sxs-lookup"><span data-stu-id="4145a-152">**Performance Warning:** Submitting anything but a single protection layer will result in runtime post-processing which comes at a significant performance penalty.</span></span>

### <a name="render-with-texture-array-and-vprt"></a><span data-ttu-id="4145a-153">Rendu avec un tableau de texture et VPRT</span><span class="sxs-lookup"><span data-stu-id="4145a-153">Render with texture array and VPRT</span></span>

<span data-ttu-id="4145a-154">Créez- `xrSwapchain` en une pour les yeux à gauche et à droite à l’aide `arraySize=2` de for Color utilise permutation, et un pour Depth.</span><span class="sxs-lookup"><span data-stu-id="4145a-154">Create one `xrSwapchain` for both left and right eye using `arraySize=2` for color swapchain, and one for depth.</span></span>
<span data-ttu-id="4145a-155">Restituez l’œil gauche dans le segment 0 et l’œil droit dans le segment 1.</span><span class="sxs-lookup"><span data-stu-id="4145a-155">Render the left eye into slice 0 and the right eye into slice 1.</span></span>
<span data-ttu-id="4145a-156">Utilisez un nuanceur avec VPRT et des appels de dessin instanciés pour le rendu stéréoscopique afin de réduire la charge GPU.</span><span class="sxs-lookup"><span data-stu-id="4145a-156">Use a shader with VPRT and instanced draw calls for stereoscopic rendering to minimize GPU load.</span></span>
<span data-ttu-id="4145a-157">Cela permet également à l’optimisation du runtime d’obtenir des performances optimales sur HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="4145a-157">This also enables the runtime's optimization to achieve the best performance on HoloLens 2.</span></span>
<span data-ttu-id="4145a-158">Les alternatives à l’utilisation d’un tableau de textures, telles que le rendu à double larges ou un utilise permutation séparé par œil, entraînent un traitement postérieur au moment de l’exécution, ce qui se traduit par une baisse significative des performances.</span><span class="sxs-lookup"><span data-stu-id="4145a-158">Alternatives to using a texture array, such as double-wide rendering or a separate swapchain per eye, will result in runtime post-processing which comes at a significant performance penalty.</span></span>

### <a name="avoid-quad-layers"></a><span data-ttu-id="4145a-159">Éviter les quatre couches</span><span class="sxs-lookup"><span data-stu-id="4145a-159">Avoid quad layers</span></span>

<span data-ttu-id="4145a-160">Au lieu d’envoyer des couches Quad en tant que couches de composition avec `XrCompositionLayerQuad` , affichez le contenu Quad directement dans le utilise permutation de projection.</span><span class="sxs-lookup"><span data-stu-id="4145a-160">Rather than submitting quad layers as composition layers with `XrCompositionLayerQuad`, render the quad content directly into the projection swapchain.</span></span>

<span data-ttu-id="4145a-161">**Avertissement de performance :** Le fait de fournir des couches supplémentaires au-delà d’une seule couche de projection, comme les couches Quad, entraîne un traitement postérieur au moment de l’exécution, ce qui se traduit par une baisse significative des performances.</span><span class="sxs-lookup"><span data-stu-id="4145a-161">**Performance Warning:** Providing additional layers beyond a single projection layer, such as quad layers, will result in runtime post-processing which comes at a significant performance penalty.</span></span>