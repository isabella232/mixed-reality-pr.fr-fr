---
title: Intégration du stockage Azure
description: Suivez ce cours pour apprendre à implémenter Stockage Table Azure et Stockage Blob Azure dans une application HoloLens 2.
author: jessemcculloch
ms.author: jemccull
ms.date: 07/01/2020
ms.topic: article
keywords: réalité mixte, unity, tutoriel, hololens, hololens 2, stockage azure, services cloud azure, Windows 10
ms.localizationpriority: high
ms.openlocfilehash: fc049fc54674b4f7387ae937f142b9b4afe44e66
ms.sourcegitcommit: daa45a19a3a353334380cda78fee7fa149f0e48b
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/28/2021
ms.locfileid: "98981708"
---
# <a name="2-integrating-azure-storage"></a><span data-ttu-id="1a4be-104">2. Intégration du stockage Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-104">2. Integrating Azure storage</span></span>

<span data-ttu-id="1a4be-105">Dans ce tutoriel, vous allez apprendre à enregistrer des données d’entités dans le stockage Table Azure et des images miniatures dans le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="1a4be-105">In this tutorial, you will learn how to save entity data to Azure Table storage and thumbnail images to Azure Blob storage.</span></span> <span data-ttu-id="1a4be-106">Cette fonctionnalité nous permettra de stocker et de récupérer des *objets suivis* avec des données telles que l’ID, le nom, l’image miniature, et ainsi de suite, entre les sessions et les appareils dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="1a4be-106">This feature will allow us to store and retrieve *Tracked Objects* with data like ID, Name, Thumbnail Image, etc. across sessions and devices to the cloud.</span></span>

## <a name="objectives"></a><span data-ttu-id="1a4be-107">Objectifs</span><span class="sxs-lookup"><span data-stu-id="1a4be-107">Objectives</span></span>

* <span data-ttu-id="1a4be-108">Apprendre les bases du stockage Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-108">Learn the basics about Azure storage</span></span>
* <span data-ttu-id="1a4be-109">Apprendre à stocker, modifier et récupérer des données à partir du stockage Table</span><span class="sxs-lookup"><span data-stu-id="1a4be-109">Learn how to store, modify and retrieve data from Table storage</span></span>
* <span data-ttu-id="1a4be-110">Apprendre à stocker et supprimer des images à partir du stockage Blob</span><span class="sxs-lookup"><span data-stu-id="1a4be-110">Learn how to store and delete images from Blob storage</span></span>

## <a name="understanding-azure-storage"></a><span data-ttu-id="1a4be-111">Présentation du stockage Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-111">Understanding Azure storage</span></span>

<span data-ttu-id="1a4be-112">**Stockage Azure** est une solution de stockage Microsoft sur le cloud qui peut couvrir de nombreux scénarios et besoins.</span><span class="sxs-lookup"><span data-stu-id="1a4be-112">**Azure storage** is a Microsoft storage solution on the cloud that can cover many scenarios and requirements.</span></span> <span data-ttu-id="1a4be-113">Elle est hautement scalable et aisément accessible aux développeurs.</span><span class="sxs-lookup"><span data-stu-id="1a4be-113">It can scale massively and is easily approachable by developers.</span></span> <span data-ttu-id="1a4be-114">Tous les services peuvent être consommés dans le cadre d’un **compte de stockage Azure**.</span><span class="sxs-lookup"><span data-stu-id="1a4be-114">All services can be consumed under the umbrella of an **Azure storage Account**.</span></span> <span data-ttu-id="1a4be-115">Pour notre cas d’usage, nous allons utiliser le *stockage Table* et le *stockage Blob*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-115">For our use case we will use *Table storage* and *Blob storage*.</span></span>

<span data-ttu-id="1a4be-116">Apprenez-en davantage sur les [services de stockage Azure](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-overview).</span><span class="sxs-lookup"><span data-stu-id="1a4be-116">Learn more about [Azure storage services](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-overview).</span></span>

### <a name="azure-table-storage"></a><span data-ttu-id="1a4be-117">Stockage Table Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-117">Azure Table storage</span></span>

<span data-ttu-id="1a4be-118">Ce service nous permet de stocker des données de manière semblable à NoSQL. Dans ce projet, nous l’utiliserons pour stocker des informations sur l’*objet suivi*, telles que nom, description, ID d’ancre spatiale et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="1a4be-118">This services allows us to store data in a NoSQL fashion, in this project we will use it to store information about the *Tracked Object* such as: name, description, spatial anchor id, and more.</span></span>

<span data-ttu-id="1a4be-119">Dans le contexte de l’application de démonstration, vous avez besoin de deux tables : une pour stocker des informations sur le projet, avec des informations relatives à l’état des modèles entraînés (nous y reviendrons dans le tutoriel [Intégration d’Azure Custom Vision](mr-learning-azure-03.md)), et une autre pour stocker des informations sur les *objets suivis*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-119">In context of the demo application, you need two Tables, one to store information about the project with information about the state of trained models more about that in the ([Integrating Azure Custom Vision](mr-learning-azure-03.md)) tutorial and a second table to store information about *Tracked Objects*.</span></span>

<span data-ttu-id="1a4be-120">Apprenez-en davantage sur le [stockage Table Azure](https://docs.microsoft.com/azure/storage/tables/table-storage-overview).</span><span class="sxs-lookup"><span data-stu-id="1a4be-120">Learn more about [Azure Table storage](https://docs.microsoft.com/azure/storage/tables/table-storage-overview).</span></span>

### <a name="azure-blob-storage"></a><span data-ttu-id="1a4be-121">Stockage Blob Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-121">Azure Blob storage</span></span>

<span data-ttu-id="1a4be-122">Ce service permet de stocker des fichiers binaires volumineux. Vous l’utiliserez pour stocker des photos des *objets suivis* sous forme de miniatures.</span><span class="sxs-lookup"><span data-stu-id="1a4be-122">This service allows to store large binary files, you will use this to store photos taken for *Tracked Objects* as thumbnail.</span></span>
<span data-ttu-id="1a4be-123">Pour l’application de démonstration, vous avez besoin d’un conteneur d’objets blob pour stocker les images.</span><span class="sxs-lookup"><span data-stu-id="1a4be-123">For of the demo application you need one Blob Container to store the images.</span></span>

<span data-ttu-id="1a4be-124">Apprenez-en davantage sur le [stockage Blob Azure](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction).</span><span class="sxs-lookup"><span data-stu-id="1a4be-124">Learn more about [Azure Blob storage](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction).</span></span>

## <a name="preparing-azure-storage"></a><span data-ttu-id="1a4be-125">Préparation du stockage Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-125">Preparing Azure Storage</span></span>

<span data-ttu-id="1a4be-126">Pour consommer les services de stockage Azure, vous avez besoin d’un compte Stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="1a4be-126">To consume the Azure storage services you will need an Azure storage account.</span></span> <span data-ttu-id="1a4be-127">Pour créer un compte de stockage, consultez [Créer un compte de stockage](https://docs.microsoft.com/azure/storage/common/storage-account-create?tabs=azure-portal).</span><span class="sxs-lookup"><span data-stu-id="1a4be-127">To create a storage account, see [Create a storage account](https://docs.microsoft.com/azure/storage/common/storage-account-create?tabs=azure-portal).</span></span> <span data-ttu-id="1a4be-128">Pour en savoir plus sur les comptes de stockage, consultez [Vue d’ensemble du compte de stockage](https://docs.microsoft.com/azure/storage/common/storage-account-overview).</span><span class="sxs-lookup"><span data-stu-id="1a4be-128">To learn more about storage accounts, see [Azure storage account overview](https://docs.microsoft.com/azure/storage/common/storage-account-overview).</span></span>

<span data-ttu-id="1a4be-129">Une fois que vous avez un compte de stockage, vous pouvez récupérer la chaîne de connexion à partir du **portail Azure**. Vous en aurez besoin dans la section suivante de cette leçon.</span><span class="sxs-lookup"><span data-stu-id="1a4be-129">Once you have a storage account, you can retrieve the connection string from the **Azure Portal** which will be needed in the next section of this lesson.</span></span>

### <a name="optional-azure-storage-explorer"></a><span data-ttu-id="1a4be-130">Explorateur Stockage Azure (facultatif)</span><span class="sxs-lookup"><span data-stu-id="1a4be-130">Optional Azure Storage Explorer</span></span>

<span data-ttu-id="1a4be-131">Même si vous pouvez voir et vérifier toutes les modifications apportées aux données à partir de l’interface utilisateur dans l’application, nous vous recommandons d’installer l’[Explorateur Stockage Azure](https://azure.microsoft.com/features/storage-explorer/).</span><span class="sxs-lookup"><span data-stu-id="1a4be-131">While you can see and verify all data changes from the UI inside the application, we recommend to install [Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/).</span></span> <span data-ttu-id="1a4be-132">Cet outil vous permet de visualiser les données dans le stockage Azure, et offre une aide précieuse lors du débogage et de l’apprentissage.</span><span class="sxs-lookup"><span data-stu-id="1a4be-132">This tool allows you to visually see the data in the Azure storage and is of great help when debugging and learning.</span></span>

> [!TIP]
> <span data-ttu-id="1a4be-133">Pour les tests à partir de l’éditeur Unity, vous pouvez utiliser un émulateur local :</span><span class="sxs-lookup"><span data-stu-id="1a4be-133">For testing from inside the Unity editor you can use a local emulator:</span></span>
>
> * <span data-ttu-id="1a4be-134">Sur Windows 10, vous pouvez utiliser l’[émulateur de stockage Azure](https://docs.microsoft.com/azure/storage/common/storage-use-emulator)</span><span class="sxs-lookup"><span data-stu-id="1a4be-134">on Windows 10 you can use [Azure Storage Emulator](https://docs.microsoft.com/azure/storage/common/storage-use-emulator)</span></span>
> * <span data-ttu-id="1a4be-135">Sur MacOS/Linux, vous pouvez utiliser l’[image Docker Azurite](https://hub.docker.com/_/microsoft-azure-storage-azurite) pour Docker</span><span class="sxs-lookup"><span data-stu-id="1a4be-135">on MacOS/Linux you can use [Azurite Docker Image](https://hub.docker.com/_/microsoft-azure-storage-azurite) for Docker</span></span>

## <a name="preparing-the-scene"></a><span data-ttu-id="1a4be-136">Préparation de la scène</span><span class="sxs-lookup"><span data-stu-id="1a4be-136">Preparing the scene</span></span>

<span data-ttu-id="1a4be-137">Dans la fenêtre de hiérarchie, recherchez l’objet **DataManager** et sélectionnez-le.</span><span class="sxs-lookup"><span data-stu-id="1a4be-137">In the Hierarchy window, locate the **DataManager** object and select it.</span></span>

![Unity avec les champs de configuration du composant de script DataManager affichés dans Inspector](images/mr-learning-azure/tutorial2-section4-step1-1.png)

<span data-ttu-id="1a4be-139">Dans la fenêtre de l’inspecteur, vous verrez que le composant **DataManager (script)** est l’endroit où sont conservés tous les paramètres liés au **stockage Azure**.</span><span class="sxs-lookup"><span data-stu-id="1a4be-139">From the Inspector window you will see that the **DataManager (script)** component is where all **Azure storage** related settings are kept.</span></span> <span data-ttu-id="1a4be-140">Tous les paramètres pertinents sont déjà définis. Il vous suffit de remplacer le champ *Connection String* (Chaîne de connexion) par celle que vous pouvez récupérer à partir du portail Azure.</span><span class="sxs-lookup"><span data-stu-id="1a4be-140">All relevant settings are already set, you just need to replace the *Connection String* field with the one you can retrieve from the Azure Portal.</span></span> <span data-ttu-id="1a4be-141">Si vous utilisez une solution d’émulateur de stockage Azure locale, vous pouvez conserver la *chaîne de connexion* déjà fournie.</span><span class="sxs-lookup"><span data-stu-id="1a4be-141">If you are using a local Azure storage emulator solution, then you can keep the already provided *Connection String*.</span></span>

<span data-ttu-id="1a4be-142">Le composant **DataManager (script)** est responsable de la communication avec le **stockage Table** et le **stockage Blob** qui est consommé par d’autres scripts de contrôleur sur les composants d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1a4be-142">The **DataManager (script)** is responsible for talking to the **Table storage** and **Blob storage** which is consumed by other controller scripts on the UI components.</span></span>

## <a name="writing-and-reading-data-from-azure-table-storage"></a><span data-ttu-id="1a4be-143">Écriture et lecture de données à partir du stockage Table Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-143">Writing and reading data from Azure Table storage</span></span>

<span data-ttu-id="1a4be-144">Maintenant que tout est prêt, vous pouvez créer un *objet suivi*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-144">With everything prepared it's time to create a *Tracked Object*.</span></span>

<span data-ttu-id="1a4be-145">Ouvrez l’application sur votre HoloLens et cliquez sur **Set Object** (Définir un objet). Vous verrez que l’objet *EnterObjectName* devient actif dans la hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="1a4be-145">Open the application on your HoloLens, click on the **Set Object** and you will see how the *EnterObjectName* object will become active in the hierarchy.</span></span> <span data-ttu-id="1a4be-146">Dans ce menu, cliquez sur la *barre de recherche* et tapez le nom que vous voulez donner à l’*objet suivi*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-146">In this menu click on the *search bar* and type in the name you want to give the *Tracked Object*.</span></span> <span data-ttu-id="1a4be-147">Après cela, cliquez sur le bouton **Set object**.</span><span class="sxs-lookup"><span data-stu-id="1a4be-147">After providing a name click on the **Set object** button.</span></span> <span data-ttu-id="1a4be-148">Cela crée l’*objet suivi* dans le stockage Table Azure, et vous verrez maintenant la **fiche d’objet**.</span><span class="sxs-lookup"><span data-stu-id="1a4be-148">This will create the *Tracked Object* on the Azure Table storage and you will see now the **Object Card**.</span></span>

<span data-ttu-id="1a4be-149">Cette **fiche d’objet** est une représentation sous forme d’interface utilisateur de l’*objet suivi*. Elle aura un rôle important à plusieurs reprises dans cette série de tutoriels.</span><span class="sxs-lookup"><span data-stu-id="1a4be-149">This **Object Card** is a UI representation of the *Tracked Object* and will have an important role several times in this tutorial series.</span></span>

<span data-ttu-id="1a4be-150">Cliquez maintenant sur la *zone de texte* de description et tapez « Car ». Après cela, cliquez sur le bouton **Enregistrer** pour enregistrer les modifications.</span><span class="sxs-lookup"><span data-stu-id="1a4be-150">Now click on the description *text box* and type in "Car", after that click on the **Save** button to save the changes.</span></span> <span data-ttu-id="1a4be-151">Arrêtez l’application et réexécutez-la.</span><span class="sxs-lookup"><span data-stu-id="1a4be-151">Stop the application and rerun it.</span></span>

<span data-ttu-id="1a4be-152">Cette fois-ci, cliquez sur **Search Object** et tapez dans la *barre de recherche* le nom utilisé lors de la création de l’*objet suivi*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-152">Now this time click on **Search Object** and type in the *search bar* the name you have used before when creating the *Tracked Object*.</span></span> <span data-ttu-id="1a4be-153">Vous constaterez que la **fiche d’objet** avec toutes les données est récupérée à partir du **stockage Table Azure**.</span><span class="sxs-lookup"><span data-stu-id="1a4be-153">You will see that the **Object Card** with all the data is retrieved from the **Azure Table storage**.</span></span>

<span data-ttu-id="1a4be-154">N’hésitez pas à fermer la **fiche d’objet** et à créer de nouveaux *objets suivis* et modifier leurs données.</span><span class="sxs-lookup"><span data-stu-id="1a4be-154">Feel free to close the **Object Card** and create new *Tracked Objects* and edit their data.</span></span>

> [!TIP]
> <span data-ttu-id="1a4be-155">Si vous avez installé l’[Explorateur Stockage Azure](https://azure.microsoft.com/features/storage-explorer/), accédez au tableau d’*objets*. Vous verrez que l’*objet suivi* créé y figure.</span><span class="sxs-lookup"><span data-stu-id="1a4be-155">If you have installed the [Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/) then look into the *objects* table and you will see there the created *Tracked Object*.</span></span>

## <a name="uploading-and-download-image-from-azure-blob-storage"></a><span data-ttu-id="1a4be-156">Chargement et téléchargement d’images à partir du stockage Blob Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-156">Uploading and Download image from Azure Blob storage</span></span>

<span data-ttu-id="1a4be-157">Dans cette section, vous allez utiliser le stockage Blob Azure pour charger et télécharger des images qui seront utilisées comme miniatures pour les *objets suivis*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-157">In this section you will use the Azure Blob storage to upload and download images that will be used as thumbnails for *Tracked Objects*.</span></span>

> [!NOTE]
> <span data-ttu-id="1a4be-158">Dans ce tutoriel, l’application va prendre des photos pour charger des images dans le stockage Blob.</span><span class="sxs-lookup"><span data-stu-id="1a4be-158">In this tutorial the application will take photos to upload images to the Blob storage.</span></span> <span data-ttu-id="1a4be-159">Si vous l’exécutez localement à partir de l’éditeur Unity, vérifiez qu’une webcam est connectée à votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="1a4be-159">If you are running this locally from the Unity editor, then make sure that you have a webcam connected to your computer.</span></span>

<span data-ttu-id="1a4be-160">Ouvrez l’application sur votre HoloLens, cliquez sur **Set Object** et tapez le nom « Car » dans la *barre de recherche*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-160">Open the application on your HoloLens, click on **Set Object** and type in the *search bar* the name "Car".</span></span> <span data-ttu-id="1a4be-161">Vous devez maintenant voir la **fiche d’objet**. Cliquez sur le bouton **Camera** et vous serez invité à effectuer un clic aérien pour prendre une photo.</span><span class="sxs-lookup"><span data-stu-id="1a4be-161">Now you should see the **Object Card**, click on the **Camera** button and you will be instructed to do an AirTap to take a photo.</span></span> <span data-ttu-id="1a4be-162">Une fois la photo prise, un message vous informe du chargement. Après quelques instants, l’image doit apparaître à la place de l’espace réservé.</span><span class="sxs-lookup"><span data-stu-id="1a4be-162">After taking a photo you will see a message that informs you about the active upload and after a while the image should appear where the placeholder was before.</span></span>

<span data-ttu-id="1a4be-163">Réexécutez l’application et recherchez l’*objet suivi*. L’image chargée doit apparaître sous forme de miniature.</span><span class="sxs-lookup"><span data-stu-id="1a4be-163">Now rerun the application and search for the *Tracked Object* and the previously uploaded image should appear as thumbnail.</span></span>

## <a name="deleting-image-from-azure-blob-storage"></a><span data-ttu-id="1a4be-164">Suppression d’une image du stockage Blob Azure</span><span class="sxs-lookup"><span data-stu-id="1a4be-164">Deleting image from Azure Blob storage</span></span>

<span data-ttu-id="1a4be-165">Dans la section précédente, vous avez chargé de nouvelles images dans le stockage Blob Azure. Dans cette section, vous allez supprimer une image miniature pour des *objets suivis*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-165">In the previous section you uploaded new images to Azure Blob storage, in this section you will delete an image thumbnail for *Tracked Objects*.</span></span>

<span data-ttu-id="1a4be-166">Ouvrez l’application sur votre HoloLens, cliquez sur **Set Object** et tapez le nom « Car » dans la *barre de recherche*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-166">Open the application on your HoloLens, click on **Set Object** and type in the *search bar* the name "Car".</span></span> <span data-ttu-id="1a4be-167">Vous devez maintenant voir la **fiche d’objet** avec l’image miniature. Cliquez sur le bouton **Delete**.</span><span class="sxs-lookup"><span data-stu-id="1a4be-167">Now you should see the **Object Card** with the thumbnail image, click on the **Delete** button.</span></span> <span data-ttu-id="1a4be-168">Vous remarquerez que l’image miniature est remplacée par l’image d’espace réservé.</span><span class="sxs-lookup"><span data-stu-id="1a4be-168">You will notice that the thumbnail image is replaced by the placeholder image.</span></span>

<span data-ttu-id="1a4be-169">À présent, réexécutez l’application et recherchez l’*objet suivi* de la miniature que vous venez de supprimer. Vous ne devriez voir que l’image d’espace réservé.</span><span class="sxs-lookup"><span data-stu-id="1a4be-169">Now rerun the application and search for the *Tracked Object* of the previously deleted thumbnail, you should only see the placeholder image.</span></span>

## <a name="congratulations"></a><span data-ttu-id="1a4be-170">Félicitations</span><span class="sxs-lookup"><span data-stu-id="1a4be-170">Congratulations</span></span>

<span data-ttu-id="1a4be-171">Dans ce tutoriel, vous avez appris à utiliser les services de stockage Azure pour conserver des données non structurées (comme dans notre cas des **objets suivis**) et des binaires sous forme d’images miniatures pour l’application de démonstration **HoloLens 2** sur le cloud.</span><span class="sxs-lookup"><span data-stu-id="1a4be-171">In this tutorial you learned how Azure storage services can be used to persist unstructured data, like in our case **Tracked Objects** and binaries in form of thumbnail images for the **HoloLens 2** demo application on the cloud.</span></span>

<span data-ttu-id="1a4be-172">Dans le tutoriel suivant, vous allez voir comment utiliser Azure Custom Vision pour détecter les images associées à un *objet suivi*.</span><span class="sxs-lookup"><span data-stu-id="1a4be-172">In the next tutorial you will learn how to use Azure Custom Vision to detect images associated with a *Tracked Object*.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="1a4be-173">Tutoriel suivant : 3. Intégration d’Azure Custom Vision</span><span class="sxs-lookup"><span data-stu-id="1a4be-173">Next tutorial: 3. Integrating Azure Custom Vision</span></span>](mr-learning-azure-03.md)
